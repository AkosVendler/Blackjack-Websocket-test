<!doctype html>
<html lang="hu">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Lobby - Real-time példa</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial;margin:20px;background:#f7f7fb;color:#111}
    .card{background:white;padding:18px;border-radius:10px;box-shadow:0 6px 18px rgba(8,8,30,0.06);max-width:720px;margin:auto}
    label{display:block;margin-top:10px;font-weight:600}
    input{width:100%;padding:8px 10px;margin-top:6px;border:1px solid #d6d9e6;border-radius:8px}
    button{margin-top:12px;padding:8px 12px;border-radius:8px;border:0;background:#2563eb;color:white;cursor:pointer}
    button.secondary{background:#10b981}
    .row{display:flex;gap:12px}
    .muted{color:#6b7280;font-size:14px}
    ul{padding-left:18px}
    .small{font-size:14px}
  </style>
</head>
<body>
  <div class="card">
    <h1>Real-time Lobby (HTML + Socket.IO)</h1>
    <p class="muted">Add meg a lobby kódot és a neved, majd csatlakozz — a bent lévőket és a számlálót mindenki látni fogja.</p>

    <label for="lobby">Lobby kód</label>
    <input id="lobby" placeholder="pl. ABC123" />

    <label for="name">Név</label>
    <input id="name" placeholder="Sanyi" />

    <div class="row">
      <button id="joinBtn">Csatlakozás</button>
      <button id="leaveBtn" style="display:none;background:#ef4444">Kilépés</button>
    </div>

    <hr style="margin:18px 0" />

    <div id="lobbyPanel" style="display:none">
      <h2>Lobby: <span id="currentLobby"></span></h2>
      <p class="small">Bent lévők:</p>
      <ul id="usersList"></ul>

      <p class="small" style="margin-top:12px">Számláló: <strong id="counter">0</strong></p>
      <div class="row">
        <button id="incBtn" class="secondary">+1</button>
      </div>
    </div>

    <p id="status" class="muted" style="margin-top:14px">Állapot: <span id="statusText">Lemondva</span></p>
  </div>

  <!-- Socket.IO client CDN -->
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <script>
    // Szükség szerint módosítsd erre a szerver URL-jét (pl. 'https://mydomain.com'):
    const SOCKET_URL = 'https://websocket-pzjq.onrender.com';

    const socket = io(SOCKET_URL, { autoConnect: false });

    const lobbyInput = document.getElementById('lobby');
    const nameInput = document.getElementById('name');
    const joinBtn = document.getElementById('joinBtn');
    const leaveBtn = document.getElementById('leaveBtn');
    const lobbyPanel = document.getElementById('lobbyPanel');
    const currentLobby = document.getElementById('currentLobby');
    const usersList = document.getElementById('usersList');
    const counterEl = document.getElementById('counter');
    const incBtn = document.getElementById('incBtn');
    const statusText = document.getElementById('statusText');

    let joinedLobby = null;

    function setStatus(text){ statusText.textContent = text; }

    joinBtn.addEventListener('click', () => {
      const lobby = (lobbyInput.value || '').trim();
      const name = (nameInput.value || '').trim() || 'Ismeretlen';
      if(!lobby){ alert('Adj meg egy lobby kódot!'); return; }

      const socket = io(SOCKET_URL, {
        autoConnect: false,
        transports: ["websocket"] // csak websocket
      });

      // connect if needed
      if(!socket.connected) socket.connect();

      socket.emit('joinLobby', lobby, name);
      joinedLobby = lobby;
      currentLobby.textContent = lobby;
      lobbyPanel.style.display = 'block';
      joinBtn.style.display = 'none';
      leaveBtn.style.display = 'inline-block';
      setStatus('Csatlakozva');
    });

    leaveBtn.addEventListener('click', () => {
      if(!joinedLobby) return;
      socket.leave(joinedLobby);
      joinedLobby = null;
      lobbyPanel.style.display = 'none';
      joinBtn.style.display = 'inline-block';
      leaveBtn.style.display = 'none';
      setStatus('Kilépve');
      usersList.innerHTML = '';
      counterEl.textContent = '0';
    });

    incBtn.addEventListener('click', () => {
      if(!joinedLobby) return; 
      socket.emit('incrementCounter', joinedLobby);
    });

    // szerver által küldött frissítések
    socket.on('lobbyUpdate', (data) => {
      // data = { users: [{id,name}], counter }
      usersList.innerHTML = '';
      if(Array.isArray(data.users)){
        data.users.forEach(u => {
          const li = document.createElement('li');
          li.textContent = u.name || ('user-' + u.id);
          usersList.appendChild(li);
        });
      }
      counterEl.textContent = (data.counter ?? 0).toString();
    });

    socket.on('connect', () => setStatus('Kapcsolódva'));
    socket.on('disconnect', () => setStatus('Kapcsolat bontva'));
    socket.on('connect_error', (err) => setStatus('Hiba: ' + (err.message || err)));

    // biztosítsuk, hogy kilépéskor a szerver értesüljön
    window.addEventListener('beforeunload', () => {
      try{ if(socket.connected) socket.disconnect(); }catch(e){}
    });
  </script>
</body>
</html>
